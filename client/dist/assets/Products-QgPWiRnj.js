import{f as v,z as G,c as J,r as c,u as K,j as e,L as y,o as X,e as d}from"./index-DFyuifyJ.js";import{u as $}from"./useMutation-C0jg7rW6.js";import{P as Y,d as H,u as W,a as Z}from"./productService-DI1icBLi.js";import{P as D}from"./plus-eOj1peSO.js";import{F as ee}from"./funnel-C5qJn7jx.js";import{T as z}from"./trash-2-Bwrh7WsY.js";import{C as f}from"./chevron-up-HHfOeKL0.js";import{C as j}from"./chevron-down-Bmnaw9AJ.js";import{E as se}from"./eye-DhudPpVJ.js";/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],re=v("circle-check",te);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],ce=v("circle-x",ae);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],le=v("pen",ne),fe=()=>{const k=G(),P=J(),[b,I]=c.useState(""),[a,l]=c.useState([]),[n,q]=c.useState("name"),[o,C]=c.useState("asc"),[i,S]=c.useState(1),[N,O]=c.useState(""),[m]=c.useState(10);c.useEffect(()=>{const s=localStorage.getItem("token"),t=JSON.parse(localStorage.getItem("user"));console.log("Authentication check:",{token:s?"Present":"Missing",user:t?"Present":"Missing",role:t==null?void 0:t.role}),(!s||!t||t.role!=="admin")&&(console.log("User not authenticated or not an admin, redirecting to login"),P("/login"))},[P]);const{data:h,isLoading:A,error:_}=K({queryKey:["products","admin"],queryFn:async()=>{console.log("Fetching products with admin parameter");const s=await Z({admin:!0});return console.log("Products data received:",s),s},staleTime:5*60*1e3,cacheTime:10*60*1e3});console.log("Products data in component:",h);const x=(h==null?void 0:h.products)||[];if(console.log("Processed products array:",x),x.length===0&&!A)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-6 space-y-4 md:space-y-0",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Products Management"}),e.jsxs(y,{to:"/admin/products/new",className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200",children:[e.jsx(D,{className:"w-5 h-5 mr-2"}),"Add New Product"]})]}),e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"No products found. Add a new product to get started."})})]})});const E=$({mutationFn:H,onSuccess:()=>{k.invalidateQueries(["products"]),d.success("Product deleted successfully"),l([])},onError:s=>{var r,u,M,F,L,T;console.error("Delete error details:",{message:s.message,response:(r=s.response)==null?void 0:r.data,status:(u=s.response)==null?void 0:u.status});let t="Error deleting product";((M=s.response)==null?void 0:M.status)===401?t="You are not authorized to delete products":((F=s.response)==null?void 0:F.status)===404?t="Product not found":(T=(L=s.response)==null?void 0:L.data)!=null&&T.message&&(t=s.response.data.message),d.error(t)}}),Q=$({mutationFn:({id:s,data:t})=>W(s,t),onSuccess:()=>{k.invalidateQueries(["products"]),d.success("Product updated successfully")},onError:s=>{var t,r;console.error("Update error:",s),d.error(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"Error updating product")}}),U=async s=>{if(window.confirm("Are you sure you want to delete this product?"))try{await E.mutateAsync(s)}catch(t){console.error("Error deleting product:",t)}},R=async()=>{if(a.length===0){d.error("Please select products to delete");return}if(window.confirm(`Are you sure you want to delete ${a.length} products?`))try{await Promise.all(a.map(s=>E.mutateAsync(s))),d.success("Selected products deleted successfully"),l([])}catch(s){console.error("Error deleting products:",s)}},g=s=>{s===n?C(o==="asc"?"desc":"asc"):(q(s),C("asc"))},V=async s=>{try{await Q.mutateAsync({id:s._id,data:{isActive:!s.isActive}})}catch(t){console.error("Error toggling status:",t)}},p=[...x.filter(s=>{if(!s||!s.name||!s.category)return!1;const t=s.name.toLowerCase().includes(b.toLowerCase())||s.category.toLowerCase().includes(b.toLowerCase()),r=!N||s.category===N;return t&&r})].sort((s,t)=>{const r=s[n],u=t[n];return o==="asc"?r>u?1:-1:r<u?1:-1}),w=Math.ceil(p.length/m),B=p.slice((i-1)*m,i*m);return A?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):_?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert",children:[e.jsx("strong",{className:"font-bold",children:"Error: "}),e.jsx("span",{className:"block sm:inline",children:_.message})]})}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-6 space-y-4 md:space-y-0",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Products Management"}),e.jsxs(y,{to:"/admin/products/new",className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200",children:[e.jsx(D,{className:"w-5 h-5 mr-2"}),"Add New Product"]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx(X,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search products...",value:b,onChange:s=>I(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsxs("select",{value:N,onChange:s=>O(s.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none bg-white",children:[e.jsx("option",{value:"",children:"All Categories"}),Object.values(Y).map(s=>e.jsx("option",{value:s,children:s},s))]})]})]}),a.length>0&&e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:R,className:"inline-flex items-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors duration-200",children:[e.jsx(z,{className:"w-5 h-5 mr-2"}),"Delete Selected (",a.length,")"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.jsx("input",{type:"checkbox",checked:a.length===x.length,onChange:s=>{s.target.checked?l(x.map(t=>t._id)):l([])},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>g("name"),children:e.jsxs("div",{className:"flex items-center",children:["Name",n==="name"&&(o==="asc"?e.jsx(f,{className:"w-4 h-4 ml-1"}):e.jsx(j,{className:"w-4 h-4 ml-1"}))]})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>g("category"),children:e.jsxs("div",{className:"flex items-center",children:["Category",n==="category"&&(o==="asc"?e.jsx(f,{className:"w-4 h-4 ml-1"}):e.jsx(j,{className:"w-4 h-4 ml-1"}))]})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>g("price"),children:e.jsxs("div",{className:"flex items-center",children:["Price",n==="price"&&(o==="asc"?e.jsx(f,{className:"w-4 h-4 ml-1"}):e.jsx(j,{className:"w-4 h-4 ml-1"}))]})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>g("stock"),children:e.jsxs("div",{className:"flex items-center",children:["Stock",n==="stock"&&(o==="asc"?e.jsx(f,{className:"w-4 h-4 ml-1"}):e.jsx(j,{className:"w-4 h-4 ml-1"}))]})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:B.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("input",{type:"checkbox",checked:a.includes(s._id),onChange:t=>{t.target.checked?l([...a,s._id]):l(a.filter(r=>r!==s._id))},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[s.image&&e.jsx("img",{src:s.image,alt:s.name,className:"h-10 w-10 rounded-full object-cover mr-3"}),e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.name})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800",children:s.category})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:["$",s.price.toFixed(2)]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${s.stock>10?"bg-green-100 text-green-800":s.stock>0?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:s.stock})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("button",{onClick:()=>V(s),className:`inline-flex items-center px-2.5 py-1.5 rounded-full text-xs font-medium ${s.isActive?"bg-green-100 text-green-800 hover:bg-green-200":"bg-red-100 text-red-800 hover:bg-red-200"}`,children:s.isActive?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"w-4 h-4 mr-1"}),"Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-4 h-4 mr-1"}),"Inactive"]})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(y,{to:`/admin/products/${s._id}/edit`,className:"text-blue-600 hover:text-blue-900",children:e.jsx(le,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>U(s._id),className:"text-red-600 hover:text-red-900",children:e.jsx(z,{className:"w-5 h-5"})}),e.jsx(y,{to:`/products/${s._id}`,className:"text-gray-600 hover:text-gray-900",children:e.jsx(se,{className:"w-5 h-5"})})]})})]},s._id))})]})}),w>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",(i-1)*m+1," to ",Math.min(i*m,p.length)," of ",p.length," products"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>S(s=>Math.max(s-1,1)),disabled:i===1,className:"px-3 py-1 rounded-md bg-white border border-gray-300 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("button",{onClick:()=>S(s=>Math.min(s+1,w)),disabled:i===w,className:"px-3 py-1 rounded-md bg-white border border-gray-300 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]})})};export{fe as default};
