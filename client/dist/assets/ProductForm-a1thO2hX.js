import{g as T,c as _,z as W,r as g,u as K,j as e,X as x,e as f}from"./index-DFyuifyJ.js";import{P as Q,u as z,e as H,g as X}from"./productService-DI1icBLi.js";import{P as D}from"./plus-eOj1peSO.js";const ee=()=>{const{id:h}=T(),I=_();W();const b=!!h,[s,o]=g.useState({name:"",sku:"",manufacturer:"",modelNumber:"",description:"",detailedDescription:"",brand:"",category:"",price:"",countInStock:"",image:"",galleryImages:[],features:[""],technicalSpecs:new Map,dimensions:{length:"",width:"",height:"",unit:"cm"},weight:{value:"",unit:"g"},warranty:{duration:"",unit:"months"},tags:[],seoMetadata:{title:"",description:"",keywords:[]},isActive:!0,isBestSeller:!1,isOnSale:!1,salePrice:"",saleStartDate:"",saleEndDate:""}),[y,P]=g.useState([]),[j,w]=g.useState([]),[Y,M]=g.useState([]),{data:l,isLoading:O}=K({queryKey:["product",h],queryFn:()=>X(h),enabled:b}),p=a=>{if(!a)return new Map;if(a instanceof Map)return a;if(typeof a=="object")try{return new Map(Object.entries(a))}catch(t){return console.error("Error converting to Map:",t),new Map}return new Map};g.useEffect(()=>{var a,t,n,r,c,d,u,m,v,k,S,C;l&&(o({name:l.name||"",sku:l.sku||"",manufacturer:l.manufacturer||"",modelNumber:l.modelNumber||"",description:l.description||"",detailedDescription:l.detailedDescription||"",brand:l.brand||"",category:l.category||"",price:((a=l.price)==null?void 0:a.toString())||"",countInStock:((t=l.countInStock)==null?void 0:t.toString())||"",image:l.image||"",galleryImages:l.galleryImages||[],features:l.features||[""],technicalSpecs:p(l.technicalSpecs),dimensions:{length:((n=l.dimensions)==null?void 0:n.length)||"",width:((r=l.dimensions)==null?void 0:r.width)||"",height:((c=l.dimensions)==null?void 0:c.height)||"",unit:((d=l.dimensions)==null?void 0:d.unit)||"cm"},weight:{value:((u=l.weight)==null?void 0:u.value)||"",unit:((m=l.weight)==null?void 0:m.unit)||"g"},warranty:{duration:((v=l.warranty)==null?void 0:v.duration)||"",unit:((k=l.warranty)==null?void 0:k.unit)||"months"},tags:l.tags||[],seoMetadata:l.seoMetadata||{title:"",description:"",keywords:[]},isActive:l.isActive||!0,isBestSeller:l.isBestSeller||!1,isOnSale:l.isOnSale||!1,salePrice:((S=l.salePrice)==null?void 0:S.toString())||"",saleStartDate:l.saleStartDate||"",saleEndDate:l.saleEndDate||""}),M(((C=l.galleryImages)==null?void 0:C.map(G=>G.url))||[]))},[l]);const i=a=>{const{name:t,value:n,type:r,checked:c}=a.target;if(t.includes(".")){const[d,u]=t.split(".");o(m=>({...m,[d]:{...m[d],[u]:r==="checkbox"?c:n}}))}else o(d=>({...d,[t]:r==="checkbox"?c:n}))},E=(a,t)=>{o(n=>({...n,features:n.features.map((r,c)=>c===a?t:r)}))},F=()=>{o(a=>({...a,features:[...a.features,""]}))},A=a=>{o(t=>({...t,features:t.features.filter((n,r)=>r!==a)}))},N=(a,t)=>{o(n=>({...n,technicalSpecs:new Map(n.technicalSpecs).set(a,t)}))},q=()=>{const a=prompt("Enter specification name:");a&&N(a,"")},B=a=>{o(t=>{const n=new Map(t.technicalSpecs);return n.delete(a),{...t,technicalSpecs:n}})},J=a=>{const t=a.target.files[0];if(t){P([t]);const n=new FileReader;n.onloadend=()=>{o(r=>({...r,image:n.result}))},n.readAsDataURL(t)}},R=a=>{const t=Array.from(a.target.files);w(n=>[...n,...t]),t.forEach(n=>{const r=new FileReader;r.onloadend=()=>{o(c=>({...c,galleryImages:[...c.galleryImages,{url:r.result,alt:n.name,order:c.galleryImages.length}]}))},r.readAsDataURL(n)})},U=a=>{o(t=>({...t,galleryImages:t.galleryImages.filter((n,r)=>r!==a)})),w(t=>t.filter((n,r)=>r!==a))},L=async a=>{var t,n;a.preventDefault();try{const r=new FormData,c={name:s.name||"",sku:s.sku||"",manufacturer:s.manufacturer||"",brand:s.brand||"",category:s.category||"",description:s.description||"",price:s.price||0,countInStock:s.countInStock||0};Object.entries(c).forEach(([d,u])=>{r.append(d,u)}),s.modelNumber&&r.append("modelNumber",s.modelNumber),s.detailedDescription&&r.append("detailedDescription",s.detailedDescription),s.features&&r.append("features",JSON.stringify(s.features)),s.technicalSpecs&&r.append("technicalSpecs",JSON.stringify(Object.fromEntries(p(s.technicalSpecs)))),s.dimensions&&r.append("dimensions",JSON.stringify(s.dimensions)),s.weight&&r.append("weight",JSON.stringify(s.weight)),s.warranty&&r.append("warranty",JSON.stringify(s.warranty)),s.tags&&r.append("tags",JSON.stringify(s.tags)),s.seoMetadata&&r.append("seoMetadata",JSON.stringify(s.seoMetadata)),r.append("isActive",s.isActive?"true":"false"),r.append("isBestSeller",s.isBestSeller?"true":"false"),r.append("isOnSale",s.isOnSale?"true":"false"),y[0]&&r.append("image",y[0]),j.length>0&&j.forEach(d=>{r.append("galleryImages",d)}),b?(await z(h,r),f.success("Product updated successfully")):(await H(r),f.success("Product created successfully")),I("/admin/products")}catch(r){console.error("Form submission error:",r),f.error(((n=(t=r.response)==null?void 0:t.data)==null?void 0:n.message)||r.message||"Error saving product")}};return O?e.jsx("div",{children:"Loading..."}):e.jsxs("form",{onSubmit:L,className:"space-y-6 max-w-4xl mx-auto p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:b?"Edit Product":"Add New Product"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Name"}),e.jsx("input",{type:"text",name:"name",value:s.name,onChange:i,required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"SKU"}),e.jsx("input",{type:"text",name:"sku",value:s.sku,onChange:i,required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Manufacturer"}),e.jsx("input",{type:"text",name:"manufacturer",value:s.manufacturer,onChange:i,required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Model Number"}),e.jsx("input",{type:"text",name:"modelNumber",value:s.modelNumber,onChange:i,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Brand"}),e.jsx("input",{type:"text",name:"brand",value:s.brand,onChange:i,required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Category"}),e.jsxs("select",{name:"category",value:s.category,onChange:i,required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select a category"}),Object.entries(Q).map(([a,t])=>e.jsx("option",{value:t,children:t},a))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Price"}),e.jsx("input",{type:"number",name:"price",value:s.price,onChange:i,required:!0,min:"0",step:"0.01",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Stock"}),e.jsx("input",{type:"number",name:"countInStock",value:s.countInStock,onChange:i,required:!0,min:"0",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{name:"description",value:s.description,onChange:i,required:!0,rows:"3",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Detailed Description"}),e.jsx("textarea",{name:"detailedDescription",value:s.detailedDescription,onChange:i,rows:"5",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Features"}),e.jsxs("div",{className:"space-y-2",children:[s.features.map((a,t)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:a,onChange:n=>E(t,n.target.value),className:"flex-1 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"}),e.jsx("button",{type:"button",onClick:()=>A(t),className:"p-2 text-red-500 hover:text-red-700",children:e.jsx(x,{className:"h-5 w-5"})})]},t)),e.jsxs("button",{type:"button",onClick:F,className:"flex items-center gap-2 text-blue-500 hover:text-blue-700",children:[e.jsx(D,{className:"h-5 w-5"}),"Add Feature"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Technical Specifications"}),e.jsxs("div",{className:"space-y-2",children:[Array.from(p(s.technicalSpecs).entries()).map(([a,t])=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:a,disabled:!0,className:"w-1/3 rounded-md border-gray-300 bg-gray-50"}),e.jsx("input",{type:"text",value:t||"",onChange:n=>N(a,n.target.value),className:"flex-1 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"}),e.jsx("button",{type:"button",onClick:()=>B(a),className:"p-2 text-red-500 hover:text-red-700",children:e.jsx(x,{className:"h-5 w-5"})})]},a)),e.jsxs("button",{type:"button",onClick:q,className:"flex items-center gap-2 text-blue-500 hover:text-blue-700",children:[e.jsx(D,{className:"h-5 w-5"}),"Add Specification"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Dimensions"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("input",{type:"number",name:"dimensions.length",value:s.dimensions.length,onChange:i,placeholder:"Length",min:"0",step:"0.1",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"}),e.jsx("input",{type:"number",name:"dimensions.width",value:s.dimensions.width,onChange:i,placeholder:"Width",min:"0",step:"0.1",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"}),e.jsx("input",{type:"number",name:"dimensions.height",value:s.dimensions.height,onChange:i,placeholder:"Height",min:"0",step:"0.1",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Weight"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",name:"weight.value",value:s.weight.value,onChange:i,min:"0",step:"0.1",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"}),e.jsxs("select",{name:"weight.unit",value:s.weight.unit,onChange:i,className:"mt-1 block w-24 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"g",children:"g"}),e.jsx("option",{value:"kg",children:"kg"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Warranty"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",name:"warranty.duration",value:s.warranty.duration,onChange:i,min:"0",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"}),e.jsxs("select",{name:"warranty.unit",value:s.warranty.unit,onChange:i,className:"mt-1 block w-32 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"months",children:"Months"}),e.jsx("option",{value:"years",children:"Years"})]})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Main Image"}),e.jsx("input",{type:"file",accept:"image/*",onChange:J,className:"mt-1 block w-full"}),s.image&&e.jsx("img",{src:s.image,alt:"Preview",className:"mt-2 h-32 w-32 object-cover rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Gallery Images"}),e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:R,className:"mt-1 block w-full"}),e.jsx("div",{className:"mt-2 grid grid-cols-4 gap-4",children:s.galleryImages.map((a,t)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:a.url,alt:a.alt,className:"h-24 w-24 object-cover rounded"}),e.jsx("button",{type:"button",onClick:()=>U(t),className:"absolute -top-2 -right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600",children:e.jsx(x,{className:"h-4 w-4"})})]},t))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"isActive",checked:s.isActive,onChange:i,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm text-gray-900",children:"Active"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"isBestSeller",checked:s.isBestSeller,onChange:i,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm text-gray-900",children:"Best Seller"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",children:b?"Update Product":"Create Product"})})]})};export{ee as P};
