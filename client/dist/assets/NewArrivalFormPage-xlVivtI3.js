import{c as F,r as f,j as e,X as N,g as L,z as T,u as R,e as j}from"./index-DFyuifyJ.js";import{u as k}from"./useMutation-C0jg7rW6.js";import{P as v}from"./plus-eOj1peSO.js";import{u as G,c as Q,a as J}from"./newArrivalService-BWgqCLlP.js";const U=({existingNewArrival:n,onSubmit:x,isSubmitting:o})=>{const w=F(),[t,l]=f.useState({name:"",description:"",detailedDescription:"",price:"",category:"",image:null,galleryImages:[],isActive:!0,startDate:"",endDate:"",features:[""],specifications:new Map,seoMetadata:{title:"",description:"",keywords:[]}}),[g,h]=f.useState(""),[b,y]=f.useState([]),[c,m]=f.useState({});f.useEffect(()=>{var s;n&&(l({name:n.name||"",description:n.description||"",detailedDescription:n.detailedDescription||"",price:n.price||"",category:n.category||"",image:null,galleryImages:[],isActive:n.isActive??!0,startDate:n.startDate?new Date(n.startDate).toISOString().split("T")[0]:"",endDate:n.endDate?new Date(n.endDate).toISOString().split("T")[0]:"",features:n.features||[""],specifications:new Map(Object.entries(n.specifications||{})),seoMetadata:n.seoMetadata||{title:"",description:"",keywords:[]}}),h(n.image||""),y(((s=n.galleryImages)==null?void 0:s.map(a=>a.url))||[]))},[n]);const i=s=>{const{name:a,value:r,type:d}=s.target;l(d==="checkbox"?u=>({...u,[a]:s.target.checked}):u=>({...u,[a]:r})),c[a]&&m(u=>({...u,[a]:""}))},p=s=>{const a=s.target.files[0];if(a){l(d=>({...d,image:a}));const r=new FileReader;r.onloadend=()=>{h(r.result)},r.readAsDataURL(a)}},M=s=>{const a=Array.from(s.target.files);l(d=>({...d,galleryImages:a}));const r=[];a.forEach(d=>{const u=new FileReader;u.onloadend=()=>{r.push(u.result),r.length===a.length&&y(r)},u.readAsDataURL(d)})},E=(s,a)=>{const r=[...t.features];r[s]=a,l(d=>({...d,features:r}))},I=()=>{l(s=>({...s,features:[...s.features,""]}))},A=s=>{const a=t.features.filter((r,d)=>d!==s);l(r=>({...r,features:a}))},D=(s,a)=>{const r=new Map(t.specifications);a?r.set(s,a):r.delete(s),l(d=>({...d,specifications:r}))},P=()=>{const s=new Map(t.specifications);s.set("",""),l(a=>({...a,specifications:s}))},S=s=>{const a=new Map(t.specifications);a.delete(s),l(r=>({...r,specifications:a}))},C=(s,a)=>{l(r=>({...r,seoMetadata:{...r.seoMetadata,[s]:a}}))},O=(s,a)=>{const r=[...t.seoMetadata.keywords];r[s]=a,l(d=>({...d,seoMetadata:{...d.seoMetadata,keywords:r}}))},z=()=>{l(s=>({...s,seoMetadata:{...s.seoMetadata,keywords:[...s.seoMetadata.keywords,""]}}))},q=s=>{const a=t.seoMetadata.keywords.filter((r,d)=>d!==s);l(r=>({...r,seoMetadata:{...r.seoMetadata,keywords:a}}))},K=()=>{const s={};return t.name.trim()||(s.name="Name is required"),t.description.trim()||(s.description="Description is required"),t.price?(isNaN(t.price)||parseFloat(t.price)<=0)&&(s.price="Price must be a positive number"):s.price="Price is required",t.category.trim()||(s.category="Category is required"),!n&&!t.image&&(s.image="Image is required"),m(s),Object.keys(s).length===0},$=async s=>{if(s.preventDefault(),!K())return;const a=new FormData;a.append("name",t.name),a.append("description",t.description),a.append("detailedDescription",t.detailedDescription),a.append("price",t.price),a.append("category",t.category),a.append("isActive",t.isActive),t.startDate&&a.append("startDate",t.startDate),t.endDate&&a.append("endDate",t.endDate),a.append("features",JSON.stringify(t.features.filter(r=>r.trim()))),a.append("specifications",JSON.stringify(Object.fromEntries(t.specifications))),a.append("seoMetadata",JSON.stringify(t.seoMetadata)),t.image&&a.append("image",t.image),t.galleryImages.length>0&&t.galleryImages.forEach((r,d)=>{a.append("galleryImages",r)});try{await x(a)}catch(r){console.error("Error submitting form:",r),m({submit:r.message||"Error submitting form"})}};return e.jsxs("form",{onSubmit:$,className:"bg-white shadow-md rounded-lg p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:["Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"name",name:"name",value:t.name,onChange:i,className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${c.name?"border-red-500":"border-gray-300"}`,disabled:o}),c.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.name})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"price",className:"block text-sm font-medium text-gray-700 mb-1",children:["Price ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",id:"price",name:"price",value:t.price,onChange:i,step:"0.01",min:"0",className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${c.price?"border-red-500":"border-gray-300"}`,disabled:o}),c.price&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.price})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"category",className:"block text-sm font-medium text-gray-700 mb-1",children:["Category ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"category",name:"category",value:t.category,onChange:i,className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${c.category?"border-red-500":"border-gray-300"}`,disabled:o}),c.category&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.category})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:["Description ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{id:"description",name:"description",value:t.description,onChange:i,rows:"4",className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${c.description?"border-red-500":"border-gray-300"}`,disabled:o}),c.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.description})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{htmlFor:"detailedDescription",className:"block text-sm font-medium text-gray-700 mb-1",children:"Detailed Description"}),e.jsx("textarea",{id:"detailedDescription",name:"detailedDescription",value:t.detailedDescription,onChange:i,rows:"6",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:o})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs("label",{htmlFor:"image",className:"block text-sm font-medium text-gray-700 mb-1",children:["Main Image ",!n&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"file",id:"image",name:"image",onChange:p,accept:"image/*",className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${c.image?"border-red-500":"border-gray-300"}`,disabled:o}),c.image&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.image}),g&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Preview:"}),e.jsx("img",{src:g,alt:"Preview",className:"max-w-xs h-auto rounded-md border border-gray-200"})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{htmlFor:"galleryImages",className:"block text-sm font-medium text-gray-700 mb-1",children:"Gallery Images"}),e.jsx("input",{type:"file",id:"galleryImages",name:"galleryImages",onChange:M,accept:"image/*",multiple:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:o}),b.length>0&&e.jsx("div",{className:"mt-2 grid grid-cols-2 md:grid-cols-4 gap-4",children:b.map((s,a)=>e.jsx("div",{className:"relative",children:e.jsx("img",{src:s,alt:`Gallery ${a+1}`,className:"w-full h-32 object-cover rounded-md border border-gray-200"})},a))})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",name:"isActive",checked:t.isActive,onChange:i,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",disabled:o}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Active"})]})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"startDate",className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",id:"startDate",name:"startDate",value:t.startDate,onChange:i,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:o})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"endDate",className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date"}),e.jsx("input",{type:"date",id:"endDate",name:"endDate",value:t.endDate,onChange:i,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:o})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Features"}),e.jsxs("div",{className:"space-y-2",children:[t.features.map((s,a)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"text",value:s,onChange:r=>E(a,r.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter feature",disabled:o}),e.jsx("button",{type:"button",onClick:()=>A(a),className:"p-2 text-red-500 hover:text-red-700",disabled:o,children:e.jsx(N,{size:20})})]},a)),e.jsxs("button",{type:"button",onClick:I,className:"flex items-center text-blue-600 hover:text-blue-800",disabled:o,children:[e.jsx(v,{size:16,className:"mr-1"}),"Add Feature"]})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Specifications"}),e.jsxs("div",{className:"space-y-2",children:[Array.from(t.specifications.entries()).map(([s,a],r)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"text",value:s,onChange:d=>D(d.target.value,a),className:"w-1/3 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Specification name",disabled:o}),e.jsx("input",{type:"text",value:a,onChange:d=>D(s,d.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Specification value",disabled:o}),e.jsx("button",{type:"button",onClick:()=>S(s),className:"p-2 text-red-500 hover:text-red-700",disabled:o,children:e.jsx(N,{size:20})})]},r)),e.jsxs("button",{type:"button",onClick:P,className:"flex items-center text-blue-600 hover:text-blue-800",disabled:o,children:[e.jsx(v,{size:16,className:"mr-1"}),"Add Specification"]})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"SEO Metadata"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"seoTitle",className:"block text-sm text-gray-600 mb-1",children:"SEO Title"}),e.jsx("input",{type:"text",id:"seoTitle",value:t.seoMetadata.title,onChange:s=>C("title",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:o})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"seoDescription",className:"block text-sm text-gray-600 mb-1",children:"SEO Description"}),e.jsx("textarea",{id:"seoDescription",value:t.seoMetadata.description,onChange:s=>C("description",s.target.value),rows:"2",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:o})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"SEO Keywords"}),e.jsxs("div",{className:"space-y-2",children:[t.seoMetadata.keywords.map((s,a)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"text",value:s,onChange:r=>O(a,r.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter keyword",disabled:o}),e.jsx("button",{type:"button",onClick:()=>q(a),className:"p-2 text-red-500 hover:text-red-700",disabled:o,children:e.jsx(N,{size:20})})]},a)),e.jsxs("button",{type:"button",onClick:z,className:"flex items-center text-blue-600 hover:text-blue-800",disabled:o,children:[e.jsx(v,{size:16,className:"mr-1"}),"Add Keyword"]})]})]})]})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>w("/admin/new-arrivals"),className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",disabled:o,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",disabled:o,children:o?"Saving...":n?"Update New Arrival":"Create New Arrival"})]})]})},B=({size:n="medium",className:x=""})=>{const o={small:"h-4 w-4",medium:"h-8 w-8",large:"h-12 w-12"};return e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("div",{className:`animate-spin rounded-full border-t-2 border-b-2 border-blue-500 ${o[n]} ${x}`})})},W=()=>{const{id:n}=L(),x=F(),o=T(),[w,t]=f.useState(!1),l=!!n,{data:g,isLoading:h}=R({queryKey:["newArrival",n],queryFn:()=>J(n),enabled:l}),b=k({mutationFn:Q,onSuccess:()=>{o.invalidateQueries(["newArrivals"]),j.success("New arrival created successfully"),x("/admin/new-arrivals")},onError:m=>{var i,p;j.error(((p=(i=m.response)==null?void 0:i.data)==null?void 0:p.message)||"Error creating new arrival"),t(!1)}}),y=k({mutationFn:({id:m,data:i})=>G(m,i),onSuccess:()=>{o.invalidateQueries(["newArrivals"]),j.success("New arrival updated successfully"),x("/admin/new-arrivals")},onError:m=>{var i,p;j.error(((p=(i=m.response)==null?void 0:i.data)==null?void 0:p.message)||"Error updating new arrival"),t(!1)}}),c=async m=>{t(!0);try{l?await y.mutateAsync({id:n,data:m}):await b.mutateAsync(m)}catch(i){console.error("Error submitting form:",i),t(!1)}};return h?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx(B,{size:"large"})}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:l?"Edit New Arrival":"Add New Arrival"}),e.jsx(U,{existingNewArrival:g,onSubmit:c,isLoading:w})]})};export{W as default};
